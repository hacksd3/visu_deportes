<html>
<head >
    <title>Ej2. Tabla de resultados</title>
    <meta charset="utf-8">
	<script src="../d3/d3.v3.min.js"></script>
	<link rel="stylesheet" type="text/css" href="../css/common-style.css">
	<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
	<script type="text/javascript">

		//Width and height
		var w = 800;
		var h = 600;

		var dataset;

		
		d3.json("../data/datos.json", function(json) {
        	console.log(json);

        	dataset = json;

        	dataset.sort(function(a, b) {
			   return d3.ascending(a.club.posicion, b.club.posicion);
			});

        	visualize()

		});





		function visualize() {

			var div = d3.select("body").append("div")   
    .attr("class", "tooltip")               
    .style("opacity", 0);


			var table = d3.select("#principal")
				.append("table")
				//.attr("class", "table")
				.append("thead")
				.append("tbody");

			var titulos = ["Equipos", "Escudo", "SparkBars" ];

			table.selectAll("th")
				.data(titulos)
				.enter()
				.append("th")
				.style("width", "150px")
				.text(function(titulos) { 
					return titulos; 
				});

			var trs = table.selectAll("tr")
				.data(dataset).enter()
				.append("tr");
				

			var equipoTd = trs.append("td")
				.text(function(d) {
					return d.club.nombreLargo;
				});
			

			var logoTd = trs.append("td")
				.append("p")
				.attr("align", "center")
				.append("img")
					.attr("src", function(d) {
						return d.club.escudo;
					})
					.attr("width", "23px")
					.attr("height", "10px")
					.attr("padding", "0px 0px")
					.attr("alt", function(d){
						return d.club.nombreCorto;
					});
				
			//addSparkBars()	

			var sparkBarsTd = trs.append("td")
				.attr("class", "spark")
				.append("svg:svg")
				.selectAll(".bar")
			      .data(function(d){
			      	return d.club.fechas;
			      })
			    .enter().
			    append("rect")
			      .attr("class", function(d) { console.log(scale(d)); return colors(scale(d)); })
			      .attr("x", function(d, i) { return x(i) + (( gap / 19  ) * i); })
			      .attr("y", function(d) { return y(scale(d)); })
			      .attr("width", x(1))
			      .attr("height", function(d) { return tall(scale(d)); })
			      .on("mouseover", function(d) {      
	            div.transition()        
	                .duration(200)      
	                .style("opacity", .9);      
	            div .html("<p>Goles visitante: " + d.golesVisitante + "</p><p>Goles local: " + d.golesLocal + "</p>")
	                .style("left", (d3.event.pageX) + "px")     
	                .style("top", (d3.event.pageY - 28) + "px");  

	            })
			       .on("mouseout", function(d) {       
			         div.transition()        
			             .duration(200)      
			             .style("opacity", 0);   
			     });
				

		}
		function scale(d) {
			  
			  var res = d.golesLocal - d.golesVisitante;
			  if(d.jugado == "0")
			  	return null;

			  if(res > 0 )
			  	return 1;
			  if(res < 0)
			  	return -1;
			  return 0;
			}

			
			var margin = {top: 20, right: 0, bottom: 0, left: 0},
			    width = 150 - margin.left - margin.right,
			    height = 40 - margin.top - margin.bottom;

			var gap = width * 0.1;

			var x = d3.scale.linear().domain([0, 20]).range([0, width - gap]);

			var y = d3.scale.ordinal().domain([-1, 0, 1, null]).range([height/2, (height/2 - (height * 0.05)), 0, 0]);

			var tall = d3.scale.ordinal().domain([-1, 0, 1, null]).range([height/2, height * 0.1, height/2, 0]);

			var colors = d3.scale.ordinal().domain([-1, 0, 1, null]).range(["bar negative", "bar drawn", "bar positive", ""]);

		
	</script>

</head>
<body>

	<div class="centered" id="principal" ></div>

</body>



</html>
